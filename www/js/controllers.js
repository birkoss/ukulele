ukuleleApp.controller('ChordsList', function($scope, $ionicModal, $ionicSideMenuDelegate, ChordsFactory, ChordTypesFactory) {

    $scope.filters = {'chord_type': 'Major'};

    $scope.chords = ChordsFactory.get();
    $scope.chord_types = ChordTypesFactory.get();

    $scope.scales = ['A', 'A#/Bb', 'B', 'C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab'];

    /* Prepare the chord detail modal */
    $ionicModal.fromTemplateUrl('chord-detail.html', {
        scope: $scope,
        animation: 'slide-in-up'
    }).then(function(modal) {
        $scope.modal_chord_detail = modal;
    });

    /* Show/Hide chord detail in a modal */
    $scope.showChord = function(chord) {
        $scope.current_chord = chord;

        $scope.current_scale = [];
        var scale_modifier = [2, 2, 1, 2, 2, 2, 1];
        $scope.scale_parts = [1, 3, 5];

        $scope.strings = ['G', 'C', 'E', 'A'];
        $scope.notes = {'G':'G', 'C':'C', 'E':'E', 'A':'A'};
        $scope.fingers = [0, 0, 0, 1];

        $scope.chord_paths = {'top': 'm 19.211191,162.37469 0.297144,-124.62532 85.223875,0 85.22387,0 0.29713,124.62532 C 190.54897,286.41428 190.53937,287 188.21017,287 186.01682,287 185.87,286.23092 185.87,274.74177 l 0,-12.25823 -25.10018,0 -25.10018,0 0,12.25823 c 0,11.47992 -0.14825,12.25823 -2.3349,12.25823 -2.18666,0 -2.3349,-0.77831 -2.3349,-12.25823 l 0,-12.25823 -25.6839,0 -25.683918,0 0,12.25823 c 0,11.47992 -0.148243,12.25823 -2.334901,12.25823 -2.186658,0 -2.334901,-0.77831 -2.334901,-12.25823 l 0,-12.25823 -25.683904,0 -25.683905,0 0,12.25823 c 0,11.48915 -0.146822,12.25823 -2.340182,12.25823 -2.329182,0 -2.338785,-0.58572 -2.043038,-124.62531 z m 55.751029,69.75515 0,-24.51646 -25.683904,0 -25.683905,0 0,24.51646 0,24.51645 25.683905,0 25.683904,0 z m 56.03762,0 0,-24.51646 -25.6839,0 -25.683918,0 0,24.51646 0,24.51645 25.683918,0 25.6839,0 z m 54.87016,0 0,-24.51646 -25.10018,0 -25.10018,0 0,24.51646 0,24.51645 25.10018,0 25.10018,0 z m -110.90778,-54.87017 0,-24.51645 -25.683904,0 -25.683905,0 0,24.51645 0,24.51646 25.683905,0 25.683904,0 z m 56.03762,0 0,-24.51645 -25.6839,0 -25.683918,0 0,24.51645 0,24.51646 25.683918,0 25.6839,0 z m 54.87016,0 0,-24.51645 -25.10018,0 -25.10018,0 0,24.51645 0,24.51646 25.10018,0 25.10018,0 z m -110.90778,-54.87015 0,-24.51646 -25.683904,0 -25.683905,0 0,24.51646 0,24.51645 25.683905,0 25.683904,0 z m 56.03762,0 0,-24.51646 -25.6839,0 -25.683918,0 0,24.51646 0,24.51645 25.683918,0 25.6839,0 z m 54.87016,0 0,-24.51646 -25.10018,0 -25.10018,0 0,24.51646 0,24.51645 25.10018,0 25.10018,0 z M 74.96222,67.519348 l 0,-24.516452 -25.683904,0 -25.683905,0 0,24.516452 0,24.516462 25.683905,0 25.683904,0 z m 56.03762,0 0,-24.516452 -25.6839,0 -25.683918,0 0,24.516452 0,24.516462 25.683918,0 25.6839,0 z m 54.87016,0 0,-24.516452 -25.10018,0 -25.10018,0 0,24.516452 0,24.516462 25.10018,0 25.10018,0 z M 19.135275,22.864379 l 0.37306,-2.626763 85.223875,0 85.22387,0 0.37305,2.626763 0.37306,2.626764 -85.96998,0 -85.969995,0 z', 'middle': 'm 19.021245,150.40628 c 0,-134.812948 0.01321,-135.585519 2.317701,-135.585519 2.163193,0 2.317701,0.772571 2.317701,11.588508 l 0,11.588508 25.494717,0 25.494717,0 0,-11.588508 c 0,-10.815937 0.15451,-11.588508 2.317702,-11.588508 2.163192,0 2.317701,0.772571 2.317701,11.588508 l 0,11.588508 25.494726,0 25.49473,0 0,-11.588508 c 0,-10.815937 0.1545,-11.588508 2.31769,-11.588508 2.16319,0 2.31771,0.772571 2.31771,11.588508 l 0,11.588508 24.91529,0 24.91529,0 0,-11.588508 c 0,-10.815937 0.15451,-11.588508 2.3177,-11.588508 2.30449,0 2.3177,0.772571 2.3177,135.585519 0,134.81296 -0.0132,135.58553 -2.3177,135.58553 -2.17055,0 -2.3177,-0.77257 -2.3177,-12.16793 l 0,-12.16793 -24.91529,0 -24.91529,0 0,12.16793 c 0,11.39536 -0.14716,12.16793 -2.31771,12.16793 -2.17055,0 -2.31769,-0.77257 -2.31769,-12.16793 l 0,-12.16793 -25.49473,0 -25.494726,0 0,12.16793 c 0,11.39536 -0.147151,12.16793 -2.317701,12.16793 -2.170551,0 -2.317702,-0.77257 -2.317702,-12.16793 l 0,-12.16793 -25.494717,0 -25.494717,0 0,12.16793 c 0,11.39536 -0.14715,12.16793 -2.317701,12.16793 -2.30449,0 -2.317701,-0.77257 -2.317701,-135.58553 z m 55.624836,81.11955 0,-24.33587 -25.494717,0 -25.494717,0 0,24.33587 0,24.33586 25.494717,0 25.494717,0 z m 55.624859,0 0,-24.33587 -25.49473,0 -25.494726,0 0,24.33587 0,24.33586 25.494726,0 25.49473,0 z m 54.46598,0 0,-24.33587 -24.91529,0 -24.91529,0 0,24.33587 0,24.33586 24.91529,0 24.91529,0 z m -110.090839,-54.46599 0,-24.33586 -25.494717,0 -25.494717,0 0,24.33586 0,24.33587 25.494717,0 25.494717,0 z m 55.624859,0 0,-24.33586 -25.49473,0 -25.494726,0 0,24.33586 0,24.33587 25.494726,0 25.49473,0 z m 54.46598,0 0,-24.33586 -24.91529,0 -24.91529,0 0,24.33586 0,24.33587 24.91529,0 24.91529,0 z m -110.090839,-54.46597 0,-24.33585 -25.494717,0 -25.494717,0 0,24.33585 0,24.33585 25.494717,0 25.494717,0 z m 55.624859,0 0,-24.33585 -25.49473,0 -25.494726,0 0,24.33585 0,24.33585 25.494726,0 25.49473,0 z m 54.46598,0 0,-24.33585 -24.91529,0 -24.91529,0 0,24.33585 0,24.33585 24.91529,0 24.91529,0 z M 74.646081,68.127896 l 0,-24.335866 -25.494717,0 -25.494717,0 0,24.335866 0,24.335864 25.494717,0 25.494717,0 z m 55.624859,0 0,-24.335866 -25.49473,0 -25.494726,0 0,24.335866 0,24.335864 25.494726,0 25.49473,0 z m 54.46598,0 0,-24.335866 -24.91529,0 -24.91529,0 0,24.335866 0,24.335864 24.91529,0 24.91529,0 z'};

        $scope.finger_paths = {'1': 'm 18.914846,74.587205 c 0,-0.819105 0.85677,-3.744115 1.90393,-6.500015 1.8719,-4.92644 1.8719,-5.01072 0,-5.01072 -3.128248,0 -2.1594,-1.76059 1.66307,-3.02211 1.96185,-0.64747 3.75442,-0.9898 3.98349,-0.76074 0.22907,0.22907 -0.67066,3.31142 -1.9994,6.84967 -1.32874,3.53825 -2.65718,7.22069 -2.9521,8.18319 -0.65344,2.132555 -2.59899,2.32773 -2.59899,0.260725 z', '2': 'm 19.164848,76.344276 c -2.3375,-0.21054 -4.25,-0.81251 -4.25,-1.33772 0,-0.5252 2.50075,-2.55463 5.55723,-4.50983 6.18484,-3.9564 7.42717,-5.86443 5.24146,-8.05013 -1.21041,-1.21041 -1.95278,-1.25703 -4.14097,-0.26002 -2.82377,1.28659 -4.7203,0.55249 -3.00474,-1.16307 1.9758,-1.9758 7.88334,-2.26785 9.67299,-0.4782 3.48142,3.48142 1.35593,7.82626 -5.942,12.14643 -1.64655,0.97471 -1.34839,1.20632 2.36603,1.83789 2.3375,0.39746 4.25,1.1331 4.25,1.63475 0,0.90127 -1.44487,0.92793 -9.75,0.1799 z', '3': 'm 16.664843,74.99637 c -2.14097,-1.247 -2.31144,-3.9199 -0.25,-3.9199 0.825,0 1.5,0.44143 1.5,0.98095 0,1.60331 4.88483,2.35953 6.51299,1.00828 2.23786,-1.85726 1.79151,-3.8747 -1.01299,-4.57858 -3.17417,-0.79667 -3.25615,-2.41065 -0.12244,-2.41065 3.32442,0 5.12983,-2.33402 3.10516,-4.01434 -1.19238,-0.98959 -2.11266,-1.01967 -4.05938,-0.13268 -3.8651,1.76106 -5.19018,1.30279 -2.56255,-0.88625 2.62445,-2.18639 5.29395,-2.48947 8.20495,-0.93154 2.03865,1.09105 2.65857,5.39913 0.93059,6.46708 -0.55202,0.34117 -0.72368,1.73586 -0.38148,3.09931 1.26726,5.04917 -6.41489,8.49264 -11.86485,5.31832 z', '4': 'm 21.914842,73.07647 c 0,-2.7619 -0.27778,-3 -3.5,-3 -2.27155,0 -3.5,-0.47381 -3.5,-1.34996 0,-2.12819 5.85086,-9.65003 7.50627,-9.65003 1.66875,0 2.0104,1.56264 0.54029,2.47122 -0.52439,0.32409 -1.90503,1.92565 -3.06809,3.55902 l -2.11466,2.96975 2.95952,0 c 2.50864,0 3.19816,-0.59643 4.52596,-3.91494 1.83636,-4.5895 4.25749,-6.729 3.37643,-2.98368 -0.31034,1.31924 -0.87806,3.41113 -1.26162,4.64862 -0.52474,1.69306 -0.2972,2.25 0.91927,2.25 0.88915,0 1.61663,0.45 1.61663,1 0,0.55 -0.92341,1 -2.05202,1 -1.38095,0 -2.39402,0.98109 -3.09782,3 -0.5752,1.65 -1.45179,3 -1.94798,3 -0.4962,0 -0.90218,-1.35 -0.90218,-3 z'};


        $scope.chord_path = $scope.chord_paths['top'];
        if( $scope.chord_paths[ chord.chords['Major'][0]['Position'] ] != undefined ) {
            $scope.chord_path = $scope.chord_paths[ chord.chords['Major'][0]['Position'] ];
        }

        for (var finger in chord.chords['Major'][0]['Fingers']) {
            var string = finger.substr(0, 1);
            var fret = finger.substr(1, 1);
        }

        var scales = $scope.scales.concat($scope.scales);
        for (var i=0; i<scales.length; i++) {
            if (scales[i] == chord.name || (scales[i].indexOf('/' + chord.name) >= 0 || scales[i].indexOf(chord.name + '/') >= 0)) {
                $scope.current_scale.push(chord.name);
                for (var j=0; j<scale_modifier.length; j++) {
                    i += scale_modifier[j];
                    var inline_scales = scales[i].split('/');
                    var scale = inline_scales[0];
                    if (inline_scales.length > 1) {
                        // Choose the best name
                        if ($scope.current_scale[$scope.current_scale.length-1].substr(0, 1) == scale.substr(0, 1)) {
                            scale = inline_scales[1];
                        }
                    }
                    $scope.current_scale.push( scale );
                }
                break;
            }
        }

        $scope.modal_chord_detail.show();
    };
    $scope.hideChord = function() {
        $scope.current_chord = null;

        $scope.modal_chord_detail.hide();
    }

    /* Toggle the filters side-menu (from the button) */
    $scope.showChordTypes = function() {
        $ionicSideMenuDelegate.toggleRight();
    };
});
